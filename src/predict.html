<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢„æµ‹å¤§å… - MagicBox</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        .main-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #ff8e8e;
        }

        /* è´¦æˆ·ä¿¡æ¯é¢æ¿æ ·å¼ - ä¸market.htmlä¿æŒä¸€è‡´ */
        .account-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 320px;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .account-toggle {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .account-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .account-toggle .account-title {
            font-size: 1.3rem;
            color: #ff8e8e;
            font-weight: 600;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .account-toggle.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .account-content {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 0 0 15px 15px;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        .account-content.expanded {
            padding: 20px;
            max-height: 500px;
        }

        .account-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .info-line:last-child {
            margin-bottom: 0;
        }

        .info-label {
            color: #ff8e8e;
        }

        .info-value {
            font-weight: 600;
            color: #fdcb6e;
        }

        .exchange-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .exchange-title {
            font-size: 1.1rem;
            color: #ff8e8e;
            margin-bottom: 10px;
            text-align: center;
        }

        .exchange-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .exchange-input {
            padding: 10px 12px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .exchange-input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.3);
        }

        .exchange-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .exchange-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .exchange-btn:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .account-buttons {
            display: flex;
            gap: 10px;
        }

        .account-btn {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .account-btn:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .account-btn.register {
            background: linear-gradient(45deg, #00b894, #55efc4);
            width: 100%;
        }

        .result-message {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            margin-top: 10px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
        }

        .result-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-message.success {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
            color: #00b894;
        }

        .result-message.error {
            background: rgba(225, 112, 85, 0.2);
            border: 1px solid #e17055;
            color: #e17055;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* é¢„æµ‹å¤§å…å®¹å™¨æ ·å¼ */
        .prediction-container {
            width: 90%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 40px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .refresh-btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .refresh-btn:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #ff8e8e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 107, 107, 0.3);
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 20px;
        }

        /* é¢„æµ‹äº‹ä»¶å¡ç‰‡æ ·å¼ */
        .prediction-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .prediction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .prediction-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prediction-title {
            font-size: 1.3rem;
            color: #ff8e8e;
            margin-bottom: 5px;
        }

        .prediction-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .prediction-content {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .option-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .option-card.winner {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.1);
        }

        .option-card.loser {
            border-color: #e17055;
            background: rgba(225, 112, 85, 0.1);
        }

        .option-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #fdcb6e;
        }

        .odds {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #ff8e8e;
        }

        .pool-info {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .option-image {
            width: 100%;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }

        .prediction-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-open {
            background: rgba(0, 184, 148, 0.2);
            color: #00b894;
        }

        .status-closed {
            background: rgba(253, 203, 110, 0.2);
            color: #fdcb6e;
        }

        .status-settled {
            background: rgba(116, 185, 255, 0.2);
            color: #74b9ff;
        }

        .total-potential {
            text-align: center;
            font-weight: 600;
            color: #fdcb6e;
            margin-top: 10px;
        }

        .creator-info {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #ff8e8e;
            font-size: 1.1rem;
        }

        .error {
            text-align: center;
            padding: 40px;
            background: rgba(225, 112, 85, 0.2);
            border: 1px solid #e17055;
            border-radius: 10px;
            color: #e17055;
            font-weight: 500;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #ff8e8e;
        }

        /* åº•éƒ¨æŒ‰é’® */
        .bottom-buttons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
        }

        .back-to-game {
            padding: 12px 30px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .back-to-game:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.5);
        }

        /* äº¤æ˜“å¤§å…æŒ‰é’® */
        .market-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 15px 25px;
            border-radius: 50px;
            border: none;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            z-index: 100;
        }

        .market-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 0 30px rgba(108, 92, 231, 0.9);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .account-panel {
                position: static;
                width: 100%;
                margin-bottom: 20px;
            }

            .prediction-container {
                width: 95%;
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .refresh-btn {
                width: 100%;
                justify-content: center;
            }

            .events-grid {
                grid-template-columns: 1fr;
            }

            .prediction-content {
                flex-direction: column;
            }

            .market-btn {
                bottom: 20px;
                left: 20px;
                padding: 12px 20px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .account-panel {
                padding: 0;
            }

            .account-toggle {
                padding: 12px 15px;
            }

            .prediction-container {
                width: 100%;
                padding: 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .prediction-card {
                padding: 15px;
            }

            .prediction-title {
                font-size: 1.1rem;
            }

            .market-btn {
                bottom: 15px;
                left: 15px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        .option-image {
            width: 100%;
            height: 220px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            overflow: hidden;
        }

        .option-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
            transition: transform 0.3s ease;
        }

        .option-card:hover .option-image img {
            transform: scale(1.05);
        }

        .image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8rem;
        }
    </style>
</head>

<body>
    <!-- è´¦æˆ·ä¿¡æ¯é¢æ¿ -->
    <div class="account-panel" id="accountPanel">
        <div class="account-toggle" id="accountToggle">
            <div class="account-title">ğŸ’° è´¦æˆ·ä¿¡æ¯</div>
            <div class="toggle-icon">â–¼</div>
        </div>
        <div class="account-content" id="accountContent">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="result-message" id="accountResult"></div>
    </div>

    <div class="main-container">
        <div class="header">
            <h1>é¢„æµ‹å¤§å…</h1>
            <div class="subtitle">å‚ä¸å„ç§æœ‰è¶£çš„é¢„æµ‹äº‹ä»¶ï¼Œèµ¢å–ä¸°åšå¥–åŠ±</div>
        </div>

        <div class="prediction-container">
            <div class="controls">
                <button id="refreshBtn" class="refresh-btn">
                    <span>ğŸ”„ åˆ·æ–°é¢„æµ‹å¤§å…</span>
                </button>
                <div class="last-update" id="lastUpdate">æœ€åæ›´æ–°: --</div>
            </div>

            <div id="predictionWrap" class="loading">
                <div class="spinner"></div> åŠ è½½é¢„æµ‹äº‹ä»¶ä¸­...
            </div>
        </div>

        <div class="bottom-buttons">
            <a href="game.html" class="back-to-game">ğŸ® è¿”å›æ¸¸æˆ</a>
        </div>
    </div>

    <a href="market.html" class="market-btn">ğŸ“ˆ äº¤æ˜“å¤§å…</a>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // DOMå…ƒç´ è·å–å‡½æ•°
            const $ = id => document.getElementById(id);

            // è·å–DOMå…ƒç´ 
            const wrap = $('predictionWrap');
            const refreshBtn = $('refreshBtn');
            const lastUpdate = $('lastUpdate');
            const accountContent = $('accountContent');
            const accountResult = $('accountResult');
            const accountToggle = $('accountToggle');

            // APIåŸºç¡€URL
            const BASE_URL = '/api';

            // è´¦æˆ·é¢æ¿çŠ¶æ€
            let isAccountExpanded = false;

            /* å·¥å…·ï¼šæ—¶é—´æˆ³ â†’ åŒ—äº¬æ—¶é—´å­—ç¬¦ä¸² */
            function fmtTime(ts) {
                const d = new Date(ts * 1000);
                return d.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
            }

            /* æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•° */
            function showResult(message, isSuccess, target = accountResult) {
                target.classList.remove('success', 'error', 'show');
                target.textContent = message;
                target.classList.add(isSuccess ? 'success' : 'error');

                void target.offsetWidth;
                target.classList.add('show');

                setTimeout(() => {
                    target.classList.remove('show');
                }, 8000);
            }

            /* è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€ */
            function setButtonLoading(button, isLoading, originalText) {
                if (isLoading) {
                    button.disabled = true;
                    button.innerHTML = '<span class="spinner"></span> å¤„ç†ä¸­...';
                } else {
                    button.disabled = false;
                    button.innerHTML = originalText;
                }
            }

            /* è·å–ç”¨æˆ·IDå’ŒCookie */
            function getUid() {
                return localStorage.getItem('uid');
            }

            function getCookie() {
                return localStorage.getItem('cookie');
            }

            /* åŠ è½½é¢„æµ‹äº‹ä»¶ */
            async function loadPredictions() {
                if (wrap) {
                    wrap.className = 'loading';
                    wrap.innerHTML = '<div class="spinner"></div> åŠ è½½é¢„æµ‹äº‹ä»¶ä¸­...';
                }

                if (refreshBtn) {
                    setButtonLoading(refreshBtn, true, 'ğŸ”„ åˆ·æ–°é¢„æµ‹å¤§å…');
                }

                try {
                    const response = await fetch(`${BASE_URL}/predict/view`);
                    const json = await response.json();

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    if (!json.success) {
                        throw new Error(json.message || 'è·å–é¢„æµ‹äº‹ä»¶å¤±è´¥');
                    }

                    if (lastUpdate && json.data && json.data.timestamp) {
                        lastUpdate.textContent = `æœ€åæ›´æ–°: ${fmtTime(json.data.timestamp)}`;
                    }

                    renderPredictions(json.data);
                } catch (error) {
                    if (wrap) {
                        wrap.className = 'error';
                        wrap.innerHTML = `åŠ è½½å¤±è´¥ï¼š${error.message}`;
                    }
                } finally {
                    if (refreshBtn) {
                        setButtonLoading(refreshBtn, false, 'ğŸ”„ åˆ·æ–°é¢„æµ‹å¤§å…');
                    }
                }
            }

            /* æ¸²æŸ“é¢„æµ‹äº‹ä»¶ */
            function renderPredictions(data) {
                if (!wrap) return;

                if (!data || !data.events || data.events.length === 0) {
                    wrap.className = 'empty';
                    wrap.innerHTML = 'æš‚æ— é¢„æµ‹äº‹ä»¶';
                    return;
                }

                // æŒ‰çŠ¶æ€åˆ†ç»„
                const openEvents = data.events.filter(event => event.status === 0);
                const closedEvents = data.events.filter(event => event.status === 1);
                const settledEvents = data.events.filter(event => event.status === 2);

                let html = '';

                // å¼€æ”¾æŠ•æ³¨çš„äº‹ä»¶
                if (openEvents.length > 0) {
                    html += `
            <div class="status-section">
              <h2 class="section-title">ğŸ¯ å¼€æ”¾æŠ•æ³¨</h2>
              <div class="events-grid">
                ${openEvents.map(event => createEventCard(event)).join('')}
              </div>
            </div>
          `;
                }

                // å·²å…³é—­çš„äº‹ä»¶
                if (closedEvents.length > 0) {
                    html += `
            <div class="status-section">
              <h2 class="section-title">â³ å·²å…³é—­</h2>
              <div class="events-grid">
                ${closedEvents.map(event => createEventCard(event)).join('')}
              </div>
            </div>
          `;
                }

                // å·²ç»“ç®—çš„äº‹ä»¶
                if (settledEvents.length > 0) {
                    html += `
            <div class="status-section">
              <h2 class="section-title">âœ… å·²ç»“ç®—</h2>
              <div class="events-grid">
                ${settledEvents.map(event => createEventCard(event)).join('')}
              </div>
            </div>
          `;
                }

                wrap.className = '';
                wrap.innerHTML = html;
            }

            /* åˆ›å»ºäº‹ä»¶å¡ç‰‡ */
            function createEventCard(event) {
                const statusInfo = getStatusInfo(event.status, event.result);
                const option1Class = event.status === 2 ? (event.result === 1 ? 'winner' : 'loser') : '';
                const option2Class = event.status === 2 ? (event.result === 2 ? 'winner' : 'loser') : '';

                return `
          <div class="prediction-card" data-event-id="${event.id}">
            <div class="prediction-header">
              <div class="prediction-title">${event.title}</div>
              <div class="prediction-description">${event.description}</div>
            </div>
            
            <div class="prediction-content">
              <div class="option-card ${option1Class}">
                <div class="option-image">ğŸ“¸ é€‰é¡¹1æ’å›¾ä½ç½®</div>
                <div class="option-name">${event.option1}</div>
                <div class="odds">${event.odds1}Ã—</div>
                <div class="pool-info">å¥–æ± : ${event.total_pool1.toFixed(2)}</div>
                <div class="pool-info">å æ¯”: ${((event.total_pool1 / event.total_pool) * 100).toFixed(1)}%</div>
              </div>
              
              <div class="option-card ${option2Class}">
                <div class="option-image">ğŸ“¸ é€‰é¡¹2æ’å›¾ä½ç½®</div>
                <div class="option-name">${event.option2}</div>
                <div class="odds">${event.odds2}Ã—</div>
                <div class="pool-info">å¥–æ± : ${event.total_pool2.toFixed(2)}</div>
                <div class="pool-info">å æ¯”: ${((event.total_pool2 / event.total_pool) * 100).toFixed(1)}%</div>
              </div>
            </div>
            
            <div class="total-potential">
              æ€»å¥–æ± : ${event.total_pool.toFixed(2)} | æ½œåœ¨æ€»é¢: ${event.potential_total.toFixed(2)}
            </div>
            
            <div class="prediction-footer">
              <div class="creator-info">
                åˆ›å»ºè€…: ${event.creator_id} | ${event.created_at}
              </div>
              <div class="status-badge ${statusInfo.class}">${statusInfo.text}</div>
            </div>
          </div>
        `;
            }

            /* è·å–çŠ¶æ€ä¿¡æ¯ */
            function getStatusInfo(status, result) {
                switch (status) {
                    case 0:
                        return { class: 'status-open', text: 'å¼€æ”¾æŠ•æ³¨' };
                    case 1:
                        return { class: 'status-closed', text: 'å·²å…³é—­' };
                    case 2:
                        if (result === 1) return { class: 'status-settled', text: 'é€‰é¡¹1è·èƒœ' };
                        if (result === 2) return { class: 'status-settled', text: 'é€‰é¡¹2è·èƒœ' };
                        return { class: 'status-settled', text: 'æœªå‡ºç»“æœ' };
                    default:
                        return { class: 'status-closed', text: 'æœªçŸ¥çŠ¶æ€' };
                }
            }

            /* è´¦æˆ·ä¿¡æ¯ç›¸å…³å‡½æ•°ï¼ˆä¸market.htmlä¿æŒä¸€è‡´ï¼‰ */
            async function loadAccountInfo() {
                const cookie = getCookie();
                if (!cookie) {
                    renderNoLogin();
                    return;
                }

                try {
                    const data = await fetch(`${BASE_URL}/market/account_info`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ cookie })
                    }).then(res => res.json());

                    if (data.success) {
                        renderAccountInfo(data.money);
                    } else {
                        renderRegisterButton();
                    }
                } catch (error) {
                    showResult('ç½‘ç»œé”™è¯¯ï¼š' + error.message, false);
                    renderRegisterButton();
                }
            }

            function renderNoLogin() {
                accountContent.innerHTML = `
          <div class="account-info">
            <div class="info-line">
              <span class="info-label">çŠ¶æ€:</span>
              <span class="info-value" style="color: #e17055;">æœªç™»å½•</span>
            </div>
          </div>
          <div class="account-buttons">
            <button class="account-btn" id="refreshPageBtn">åˆ·æ–°é¡µé¢</button>
          </div>
        `;
            }

            function renderRegisterButton() {
                const uid = getUid();
                accountContent.innerHTML = `
          <div class="account-info">
            <div class="info-line">
              <span class="info-label">ç”¨æˆ·ID:</span>
              <span class="info-value">${uid || 'æœªçŸ¥'}</span>
            </div>
            <div class="info-line">
              <span class="info-label">è´¦æˆ·çŠ¶æ€:</span>
              <span class="info-value" style="color: #e17055;">æœªå¼€é€š</span>
            </div>
          </div>
          <button class="account-btn register" id="registerBtn">å¼€é€šäº¤æ˜“è´¦æˆ·</button>
        `;
            }

            function renderAccountInfo(money) {
                const uid = getUid();
                accountContent.innerHTML = `
          <div class="account-info">
            <div class="info-line">
              <span class="info-label">ç”¨æˆ·ID:</span>
              <span class="info-value">${uid || 'æœªçŸ¥'}</span>
            </div>
            <div class="info-line">
              <span class="info-label">äº¤æ˜“å¸ä½™é¢:</span>
              <span class="info-value">${money.toFixed(2) || 0}</span>
            </div>
          </div>
          <div class="exchange-section">
            <div class="exchange-title">äº¤æ˜“å¸å…‘æ¢</div>
            <div class="exchange-form">
              <input type="number" id="coinInput" class="exchange-input" placeholder="è¾“å…¥é‡‘å¸æ•°é‡" min="1">
              <button class="exchange-btn coin-to-money" id="coinToMoneyBtn">é‡‘å¸ â†’ äº¤æ˜“å¸</button>
            </div>
            <div class="exchange-form">
              <input type="number" id="moneyInput" class="exchange-input" placeholder="è¾“å…¥äº¤æ˜“å¸æ•°é‡ï¼ˆ100çš„å€æ•°ï¼‰" min="100" step="100">
              <button class="exchange-btn money-to-coin" id="moneyToCoinBtn">äº¤æ˜“å¸ â†’ é‡‘å¸</button>
            </div>
          </div>
          <div class="account-buttons">
            <button class="account-btn" id="refreshAccountBtn">åˆ·æ–°è´¦æˆ·ä¿¡æ¯</button>
          </div>
        `;
            }

            /* åˆ‡æ¢è´¦æˆ·é¢æ¿å±•å¼€/æ”¶èµ· */
            function toggleAccountPanel() {
                isAccountExpanded = !isAccountExpanded;

                if (isAccountExpanded) {
                    accountToggle.classList.add('expanded');
                    accountContent.classList.add('expanded');
                    loadAccountInfo();
                } else {
                    accountToggle.classList.remove('expanded');
                    accountContent.classList.remove('expanded');
                }
            }

            /* äº‹ä»¶å§”æ‰˜å¤„ç†å‡½æ•° */
            function handleAccountPanelClick(e) {
                const target = e.target;

                if (target.id === 'refreshAccountBtn') {
                    loadAccountInfo();
                } else if (target.id === 'refreshPageBtn') {
                    location.reload();
                }
                // å…¶ä»–è´¦æˆ·ç›¸å…³åŠŸèƒ½å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
            }

            /* åˆå§‹åŒ–äº‹ä»¶ç»‘å®š */
            if (refreshBtn) {
                refreshBtn.onclick = loadPredictions;
            }

            if (accountToggle) {
                accountToggle.addEventListener('click', toggleAccountPanel);
            }

            accountContent.addEventListener('click', handleAccountPanelClick);

            // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é¢„æµ‹äº‹ä»¶
            loadPredictions();

            /* åˆ›å»ºäº‹ä»¶å¡ç‰‡ - ä¿®æ”¹å›¾ç‰‡è·¯å¾„éƒ¨åˆ† */
            function createEventCard(event, index) {
                const statusInfo = getStatusInfo(event.status, event.result);
                const option1Class = event.status === 2 ? (event.result === 1 ? 'winner' : 'loser') : '';
                const option2Class = event.status === 2 ? (event.result === 2 ? 'winner' : 'loser') : '';

                // è®¡ç®—å›¾ç‰‡è·¯å¾„ï¼šç¬¬ä¸€ä¸ªäº‹ä»¶ç”¨1-1,1-2ï¼Œç¬¬äºŒä¸ªç”¨2-1,2-2ï¼Œä»¥æ­¤ç±»æ¨
                const imageIndex = index + 1;
                const imagePath1 = `./images/${imageIndex}-1`;
                const imagePath2 = `./images/${imageIndex}-2`;

                return `
          <div class="prediction-card" data-event-id="${event.id}">
            <div class="prediction-header">
              <div class="prediction-title">${event.title}</div>
              <div class="prediction-description">${event.description}</div>
            </div>
            
            <div class="prediction-content">
              <div class="option-card ${option1Class}">
                <div class="option-image">
                  <img src="${imagePath1}.jpg" alt="${event.option1}" 
                       onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                  <div class="image-placeholder" style="display: none;">
                    ğŸ“¸ ${event.option1}
                  </div>
                </div>
                <div class="option-name">${event.option1}</div>
                <div class="odds">${event.odds1}Ã—</div>
                <div class="pool-info">å¥–æ± : ${event.total_pool1.toFixed(2)}</div>
                <div class="pool-info">å æ¯”: ${((event.total_pool1 / event.total_pool) * 100).toFixed(1)}%</div>
              </div>
              
              <div class="option-card ${option2Class}">
                <div class="option-image">
                  <img src="${imagePath2}.jpg" alt="${event.option2}"
                       onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                  <div class="image-placeholder" style="display: none;">
                    ğŸ“¸ ${event.option2}
                  </div>
                </div>
                <div class="option-name">${event.option2}</div>
                <div class="odds">${event.odds2}Ã—</div>
                <div class="pool-info">å¥–æ± : ${event.total_pool2.toFixed(2)}</div>
                <div class="pool-info">å æ¯”: ${((event.total_pool2 / event.total_pool) * 100).toFixed(1)}%</div>
              </div>
            </div>
            
            <div class="total-potential">
              æ€»å¥–æ± : ${event.total_pool.toFixed(2)} | æ½œåœ¨æ€»é¢: ${event.potential_total.toFixed(2)}
            </div>
            
            <div class="prediction-footer">
              <div class="creator-info">
                åˆ›å»ºè€…: ${event.creator_id} | ${event.created_at}
              </div>
              <div class="status-badge ${statusInfo.class}">${statusInfo.text}</div>
            </div>
          </div>
        `;
            }

            /* æ¸²æŸ“é¢„æµ‹äº‹ä»¶ - ä¿®æ”¹è°ƒç”¨éƒ¨åˆ† */
            function renderPredictions(data) {
                if (!wrap) return;

                if (!data || !data.events || data.events.length === 0) {
                    wrap.className = 'empty';
                    wrap.innerHTML = 'æš‚æ— é¢„æµ‹äº‹ä»¶';
                    return;
                }

                // æŒ‰çŠ¶æ€åˆ†ç»„
                const openEvents = data.events.filter(event => event.status === 0);
                const closedEvents = data.events.filter(event => event.status === 1);
                const settledEvents = data.events.filter(event => event.status === 2);

                let html = '';

                // å¼€æ”¾æŠ•æ³¨çš„äº‹ä»¶
                if (openEvents.length > 0) {
                    html += `
            <div class="status-section">
              <h2 class="section-title">ğŸ¯ å¼€æ”¾æŠ•æ³¨</h2>
              <div class="events-grid">
                ${openEvents.map((event, index) => createEventCard(event, index)).join('')}
              </div>
            </div>
          `;
                }

                // å·²å…³é—­çš„äº‹ä»¶
                if (closedEvents.length > 0) {
                    html += `
            <div class="status-section">
              <h2 class="section-title">â³ å·²å…³é—­</h2>
              <div class="events-grid">
                ${closedEvents.map((event, index) => createEventCard(event, index + openEvents.length)).join('')}
              </div>
            </div>
          `;
                }

                // å·²ç»“ç®—çš„äº‹ä»¶
                if (settledEvents.length > 0) {
                    html += `
            <div class="status-section">
              <h2 class="section-title">âœ… å·²ç»“ç®—</h2>
              <div class="events-grid">
                ${settledEvents.map((event, index) => createEventCard(event, index + openEvents.length + closedEvents.length)).join('')}
              </div>
            </div>
          `;
                }

                wrap.className = '';
                wrap.innerHTML = html;
            }

            // å…¶ä»–ä»£ç ä¿æŒä¸å˜...
        });
    </script>
</body>

</html>