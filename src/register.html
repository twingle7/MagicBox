<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Magic Box - æ³¨å†Œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      display: flex;
      max-width: 1000px;
      width: 100%;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }

    .register-section {
      flex: 1;
      padding: 40px;
    }

    .game-info {
      flex: 1;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e1e5ee;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #6a11cb;
      box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
    }

    /* é‚®ç®±å’ŒéªŒè¯ç è¾“å…¥ç»„æ ·å¼ */
    .email-verification-group {
      display: flex;
      gap: 10px;
    }

    .email-input {
      flex: 1;
    }

    #getCodeBtn {
      width: 120px;
      padding: 12px 5px;
      background: linear-gradient(to right, #2575fc, #6a11cb);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    #getCodeBtn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(37, 117, 252, 0.3);
    }

    #getCodeBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ */
    .password-strength {
      display: flex;
      align-items: center;
      margin-top: 8px;
      gap: 5px;
    }

    .strength-bar {
      height: 4px;
      flex: 1;
      background: #e0e0e0;
      border-radius: 2px;
      overflow: hidden;
    }

    .strength-fill {
      height: 100%;
      width: 0%;
      background: #f44336;
      transition: all 0.3s ease;
    }

    .strength-text {
      font-size: 12px;
      color: #666;
      min-width: 60px;
      text-align: right;
    }

    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    #submitBtn {
      background: linear-gradient(to right, #6a11cb, #2575fc);
      color: white;
    }

    #submitBtn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
    }

    #submitBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #backBtn {
      background: #f8f9fa;
      color: #6a11cb;
      border: 2px solid #e1e5ee;
    }

    #backBtn:hover {
      background: #e9ecef;
    }

    #msg {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
    }

    .err {
      background-color: #ffe6e6;
      color: #d32f2f;
      border-left: 4px solid #d32f2f;
    }

    .ok {
      background-color: #e6f4ea;
      color: #0f9d58;
      border-left: 4px solid #0f9d58;
    }

    .info {
      background-color: #e3f2fd;
      color: #1565c0;
      border-left: 4px solid #1565c0;
    }

    .game-title {
      font-size: 28px;
      margin-bottom: 20px;
      text-align: center;
    }

    .game-description {
      line-height: 1.6;
      font-size: 16px;
      text-align: justify;
    }

    .highlight {
      font-weight: 600;
      color: #ffeb3b;
    }

    .green-text {
      color: #4caf50;
    }

    .red-text {
      color: #f44336;
    }

    /* å€’è®¡æ—¶æ ·å¼ */
    .countdown {
      color: #6a11cb;
      font-weight: bold;
    }

    /* å¯†ç åŒ¹é…æç¤º */
    .password-match {
      font-size: 12px;
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .match-icon {
      font-size: 14px;
    }

    .match {
      color: #4caf50;
    }

    .mismatch {
      color: #f44336;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .game-info {
        order: -1;
      }

      .email-verification-group {
        flex-direction: column;
      }

      #getCodeBtn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="register-section">
      <h1>åˆ›å»ºè´¦æˆ·</h1>
      <p class="subtitle">æ³¨å†Œæ‚¨çš„Magic Boxè´¦æˆ·</p>

      <form id="registerForm">
        <div class="form-group">
          <label for="uid">ç”¨æˆ·IDï¼š</label>
          <input id="uid" type="text" placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ3-20ä½å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ï¼‰" autocomplete="username" required />
        </div>

        <div class="form-group">
          <label for="email">é‚®ç®±ï¼š</label>
          <div class="email-verification-group">
            <div class="email-input">
              <input id="email" type="email" placeholder="è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€" required />
            </div>
            <button id="getCodeBtn" type="button">è·å–éªŒè¯ç </button>
          </div>
        </div>

        <div class="form-group">
          <label for="verificationCode">éªŒè¯ç ï¼š</label>
          <input id="verificationCode" type="text" placeholder="è¯·è¾“å…¥é‚®ç®±æ”¶åˆ°çš„éªŒè¯ç " required />
        </div>

        <div class="form-group">
          <label for="pwd">å¯†ç ï¼š</label>
          <input id="pwd" type="password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" autocomplete="new-password" required />
          <div class="password-strength">
            <div class="strength-bar">
              <div class="strength-fill" id="strengthFill"></div>
            </div>
            <div class="strength-text" id="strengthText">å¼±</div>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPwd">ç¡®è®¤å¯†ç ï¼š</label>
          <input id="confirmPwd" type="password" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " autocomplete="new-password" required />
          <div class="password-match" id="passwordMatch">
            <span class="match-icon">ğŸ”’</span>
            <span>è¯·ç¡®è®¤å¯†ç </span>
          </div>
        </div>

        <div id="msg"></div>

        <div class="btn-group">
          <button id="submitBtn" type="submit">æ³¨å†Œ</button>
          <button id="backBtn" type="button">è¿”å›ç™»å½•</button>
        </div>
      </form>
    </div>

    <div class="game-info">
      <h2 class="game-title">Magic Box æ¸¸æˆç®€ä»‹</h2>
      <p class="game-description">
        æ¬¢è¿æ¥åˆ°<span class="highlight">Magic Box</span>ï¼åœ¨è¿™ä¸ªåˆºæ¿€çš„æ¸¸æˆä¸­ï¼Œä½ å°†ä¼šæ‹¥æœ‰ä¸€ä¸ªç¥å¥‡çš„é­”æ³•ç›’å­ï¼Œä»¥åŠ<span
          class="highlight">10,000æšç¡¬å¸</span>çš„å¯åŠ¨èµ„é‡‘ã€‚
        <br><br>
        æ¯æ¬¡æ¸¸æˆï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€å®šé‡çš„ç¡¬å¸æŠ•å…¥é­”æ³•ç›’å­ä¸­ã€‚ç»“æœå°†ç”±å‘½è¿å†³å®šï¼š
        <br><br>
        â€¢ <span class="green-text">æœ‰50%çš„å‡ ç‡ç¿»å€</span> - ä½ çš„ç¡¬å¸æ•°é‡å°†ç¿»å€ï¼
        <br>
        â€¢ <span class="red-text">æœ‰50%çš„å‡ ç‡å½’é›¶</span> - ä½ æŠ•å…¥çš„ç¡¬å¸å°†å…¨éƒ¨æ¶ˆå¤±ï¼
        <br><br>
        è€ƒéªŒä½ çš„å‹‡æ°”ä¸æ™ºæ…§ï¼Œåˆç†åˆ†é…ä½ çš„ç¡¬å¸ï¼Œçœ‹çœ‹ä½ èƒ½èµ°å¤šè¿œï¼
        <br><br>
        <span class="highlight">ç¥ä½ å¥½è¿ï¼</span>
      </p>
    </div>
  </div>

  <script>
    // çº¯JavaScriptå®ç°çš„SHA256å‡½æ•°ï¼ˆä¸ç™»å½•å’Œä¿®æ”¹å¯†ç é¡µé¢ç›¸åŒï¼‰
    function sha256(str) {
      // åˆå§‹åŒ–å¸¸é‡
      const K = [
        0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
        0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
        0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
        0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
        0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
        0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
        0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
        0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2
      ];

      // åˆå§‹å“ˆå¸Œå€¼
      let H = [
        0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a,
        0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19
      ];

      // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
      const bytes = new TextEncoder().encode(str);

      // é¢„å¤„ç†ï¼šæ·»åŠ å¡«å……ä½
      const bits = bytes.length * 8;
      const blocks = [];

      for (let i = 0; i < bytes.length; i++) {
        if (i % 4 === 0) blocks[i >> 2] = 0;
        blocks[i >> 2] |= bytes[i] << (24 - (i % 4) * 8);
      }

      // æ·»åŠ 1æ¯”ç‰¹
      blocks[bytes.length >> 2] |= 0x80 << (24 - (bytes.length % 4) * 8);

      // æ·»åŠ åŸå§‹é•¿åº¦
      blocks[(((bits + 64) >>> 9) << 4) + 15] = bits;

      // å¤„ç†æ¯ä¸ª512ä½å—
      for (let i = 0; i < blocks.length; i += 16) {
        const W = new Array(64);

        // å‡†å¤‡æ¶ˆæ¯è°ƒåº¦
        for (let t = 0; t < 16; t++) {
          W[t] = blocks[i + t] || 0;
        }

        for (let t = 16; t < 64; t++) {
          const s0 = rotr(W[t - 15], 7) ^ rotr(W[t - 15], 18) ^ (W[t - 15] >>> 3);
          const s1 = rotr(W[t - 2], 17) ^ rotr(W[t - 2], 19) ^ (W[t - 2] >>> 10);
          W[t] = (W[t - 16] + s0 + W[t - 7] + s1) & 0xffffffff;
        }

        // åˆå§‹åŒ–å·¥ä½œå˜é‡
        let [a, b, c, d, e, f, g, h] = H;

        // ä¸»å¾ªç¯
        for (let t = 0; t < 64; t++) {
          const S1 = rotr(e, 6) ^ rotr(e, 11) ^ rotr(e, 25);
          const ch = (e & f) ^ (~e & g);
          const temp1 = (h + S1 + ch + K[t] + W[t]) & 0xffffffff;
          const S0 = rotr(a, 2) ^ rotr(a, 13) ^ rotr(a, 22);
          const maj = (a & b) ^ (a & c) ^ (b & c);
          const temp2 = (S0 + maj) & 0xffffffff;

          h = g;
          g = f;
          f = e;
          e = (d + temp1) & 0xffffffff;
          d = c;
          c = b;
          b = a;
          a = (temp1 + temp2) & 0xffffffff;
        }

        // è®¡ç®—ä¸­é—´å“ˆå¸Œå€¼
        H[0] = (H[0] + a) & 0xffffffff;
        H[1] = (H[1] + b) & 0xffffffff;
        H[2] = (H[2] + c) & 0xffffffff;
        H[3] = (H[3] + d) & 0xffffffff;
        H[4] = (H[4] + e) & 0xffffffff;
        H[5] = (H[5] + f) & 0xffffffff;
        H[6] = (H[6] + g) & 0xffffffff;
        H[7] = (H[7] + h) & 0xffffffff;
      }

      // ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œå­—ç¬¦ä¸²
      let hash = '';
      for (let i = 0; i < 8; i++) {
        hash += (H[i] >>> 0).toString(16).padStart(8, '0');
      }

      return hash;
    }

    // å¾ªç¯å³ç§»è¾…åŠ©å‡½æ•°
    function rotr(x, n) {
      return (x >>> n) | (x << (32 - n));
    }

    // å¼‚æ­¥åŒ…è£…å‡½æ•°ï¼Œä¿æŒæ¥å£ä¸€è‡´
    async function sha256Async(message) {
      return sha256(message);
    }

    const $ = id => document.getElementById(id);
    const registerForm = $('registerForm');
    const uid = $('uid');
    const email = $('email');
    const verificationCode = $('verificationCode');
    const pwd = $('pwd');
    const confirmPwd = $('confirmPwd');
    const getCodeBtn = $('getCodeBtn');
    const msg = $('msg');
    const btn = $('submitBtn');
    const strengthFill = $('strengthFill');
    const strengthText = $('strengthText');
    const passwordMatch = $('passwordMatch');

    // å¯†ç å¼ºåº¦æ£€æµ‹
    pwd.addEventListener('input', function () {
      const password = this.value;
      let strength = 0;
      let text = 'å¼±';
      let color = '#f44336';
      let width = '0%';

      if (password.length >= 6) strength++;
      if (password.length >= 8) strength++;
      if (/[A-Z]/.test(password)) strength++;
      if (/[0-9]/.test(password)) strength++;
      if (/[^A-Za-z0-9]/.test(password)) strength++;

      switch (strength) {
        case 0:
        case 1:
          text = 'å¼±';
          color = '#f44336';
          width = '25%';
          break;
        case 2:
        case 3:
          text = 'ä¸­';
          color = '#ff9800';
          width = '50%';
          break;
        case 4:
          text = 'å¼º';
          color = '#4caf50';
          width = '75%';
          break;
        case 5:
          text = 'å¾ˆå¼º';
          color = '#2e7d32';
          width = '100%';
          break;
      }

      strengthFill.style.width = width;
      strengthFill.style.backgroundColor = color;
      strengthText.textContent = text;
      strengthText.style.color = color;

      // æ£€æŸ¥å¯†ç æ˜¯å¦åŒ¹é…
      checkPasswordMatch();
    });

    // å¯†ç åŒ¹é…æ£€æŸ¥
    confirmPwd.addEventListener('input', checkPasswordMatch);

    function checkPasswordMatch() {
      const password = pwd.value;
      const confirm = confirmPwd.value;
      const icon = passwordMatch.querySelector('.match-icon');
      const text = passwordMatch.querySelector('span:last-child');

      if (confirm === '') {
        icon.textContent = 'ğŸ”’';
        icon.className = 'match-icon';
        text.textContent = 'è¯·ç¡®è®¤å¯†ç ';
        text.className = '';
        return false;
      }

      if (password === confirm) {
        icon.textContent = 'âœ“';
        icon.className = 'match-icon match';
        text.textContent = 'å¯†ç åŒ¹é…';
        text.className = 'match';
        return true;
      } else {
        icon.textContent = 'âœ—';
        icon.className = 'match-icon mismatch';
        text.textContent = 'å¯†ç ä¸åŒ¹é…';
        text.className = 'mismatch';
        return false;
      }
    }

    // è·å–éªŒè¯ç å€’è®¡æ—¶
    let countdown = 0;
    let countdownInterval = null;

    getCodeBtn.onclick = async () => {
      if (!email.value) {
        show('è¯·è¾“å…¥é‚®ç®±åœ°å€', false);
        return;
      }

      // ç®€å•çš„é‚®ç®±éªŒè¯
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email.value)) {
        show('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', false);
        return;
      }

      getCodeBtn.disabled = true;
      show('æ­£åœ¨å‘é€éªŒè¯ç ...', true);

      try {
        // è¿™é‡Œè°ƒç”¨è·å–éªŒè¯ç çš„æ¥å£
        const res = await fetch('/api/user/email_send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email.value })
        });

        const data = await res.json();

        if (data.code === 0) {
          show('éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶', true);
          startCountdown();
        } else {
          show(data.msg || 'éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', false);
          getCodeBtn.disabled = false;
        }
      } catch (e) {
        show('ç½‘ç»œé”™è¯¯ï¼š' + e.message, false);
        getCodeBtn.disabled = false;
      }
    };

    function startCountdown() {
      countdown = 60;
      getCodeBtn.textContent = `${countdown}ç§’åé‡æ–°è·å–`;

      countdownInterval = setInterval(() => {
        countdown--;
        if (countdown > 0) {
          getCodeBtn.textContent = `${countdown}ç§’åé‡æ–°è·å–`;
        } else {
          clearInterval(countdownInterval);
          getCodeBtn.textContent = 'è·å–éªŒè¯ç ';
          getCodeBtn.disabled = false;
        }
      }, 1000);
    }

    registerForm.onsubmit = async (e) => {
      e.preventDefault();
      // éªŒè¯æ‰€æœ‰å¿…å¡«é¡¹
      if (!uid.value || !email.value || !verificationCode.value || !pwd.value || !confirmPwd.value) {
        show('è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹', false);
        return;
      }

      // éªŒè¯ç”¨æˆ·åæ ¼å¼ï¼ˆ3-20ä½å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼‰
      const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
      if (!usernameRegex.test(uid.value)) {
        show('ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®ï¼ˆ3-20ä½å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ï¼‰', false);
        return;
      }

      // éªŒè¯é‚®ç®±æ ¼å¼
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email.value)) {
        show('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', false);
        return;
      }

      // éªŒè¯éªŒè¯ç ï¼ˆ6ä½æ•°å­—ï¼‰
      const codeRegex = /^\d{6}$/;
      if (!codeRegex.test(verificationCode.value)) {
        show('éªŒè¯ç æ ¼å¼ä¸æ­£ç¡®ï¼ˆ6ä½æ•°å­—ï¼‰', false);
        return;
      }

      // éªŒè¯å¯†ç é•¿åº¦
      if (pwd.value.length < 6) {
        show('å¯†ç é•¿åº¦è‡³å°‘6ä½', false);
        return;
      }

      // éªŒè¯å¯†ç æ˜¯å¦åŒ¹é…
      if (!checkPasswordMatch()) {
        show('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', false);
        return;
      }

      btn.disabled = true;
      show('æ­£åœ¨æ³¨å†Œ...', true);

      try {
        // ä½¿ç”¨çº¯JavaScriptå®ç°çš„SHA256è®¡ç®—å¯†ç çš„å“ˆå¸Œå€¼
        const pwdHash = await sha256Async(pwd.value);

        // è°ƒç”¨æ³¨å†Œæ¥å£ï¼Œå‘é€å¯†ç å“ˆå¸Œå€¼
        const res = await fetch('/api/user/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            id: uid.value,
            pwd_hash: pwdHash,  // å‘é€å¯†ç å“ˆå¸Œå€¼
            email: email.value,
            code: verificationCode.value
          })
        });

        const data = await res.json();
        handle(data);
      } catch (e) {
        show('ç½‘ç»œé”™è¯¯ï¼š' + e.message, false);
      } finally {
        btn.disabled = false;
      }
    };

    function handle(data) {
      if (data.code === 0) {          // æ³¨å†ŒæˆåŠŸ
        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
        localStorage.setItem('uid', uid.value);
        if (data.cookie) {
          localStorage.setItem('cookie', data.cookie);
        }

        show(data.msg + 'ï¼Œå³å°†è¿›å…¥ç™»å½•ç•Œé¢...', true);

        // ç™»å½•æˆåŠŸåï¼Œå‘é€ user_finish è¯·æ±‚ï¼ˆä¸ç™»å½•é¡µé¢ä¿æŒä¸€è‡´ï¼‰
        if (data.cookie) {
          sendUserFinishRequest(data.cookie);
        }

        setTimeout(() => location.href = 'index.html', 1200);
      } else {                          // æ³¨å†Œå¤±è´¥
        show(data.msg, false);
      }
    }

    // å‘é€ user_finish è¯·æ±‚ï¼ˆä¸ç™»å½•é¡µé¢ä¿æŒä¸€è‡´ï¼‰
    async function sendUserFinishRequest(cookie) {
      try {
        const res = await fetch('/api/task/user_finish', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cookie: cookie, task_id: 0 })
        });

        const result = await res.json();

        if (result.success) {
          console.log('user_finish è¯·æ±‚å‘é€æˆåŠŸ');
        } else {
          console.log('user_finish è¯·æ±‚å¤±è´¥');
        }
      } catch (error) {
        console.error('å‘é€ user_finish è¯·æ±‚æ—¶å‡ºé”™:', error);
      }
    }

    function show(text, isOk) {
      msg.textContent = text;

      // æ ¹æ®æ¶ˆæ¯ç±»å‹è®¾ç½®æ ·å¼
      if (text.includes('éªŒè¯ç å·²å‘é€')) {
        msg.className = 'info';
      } else if (isOk) {
        msg.className = 'ok';
      } else {
        msg.className = 'err';
      }

      // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼ˆæˆåŠŸæ¶ˆæ¯ä¸è‡ªåŠ¨æ¶ˆå¤±ï¼‰
      if (!isOk || text.includes('éªŒè¯ç å·²å‘é€')) {
        setTimeout(() => {
          if (msg.textContent === text) {
            msg.textContent = '';
            msg.className = '';
          }
        }, 3000);
      }
    }

    // æ·»åŠ è¿”å›ç™»å½•é¡µé¢çš„åŠŸèƒ½
    $('backBtn').onclick = () => location.href = 'index.html';
  </script>
</body>

</html>