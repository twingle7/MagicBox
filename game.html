<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>æ¸¸æˆç•Œé¢</title>
  <style>body{margin:40px;font:20px/1.5 Arial;text-align:center}</style>
</head>
<body>
  <h1>ğŸ® æ¬¢è¿æ¥åˆ°æ¸¸æˆç•Œé¢</h1>
  <!-- æŒ‰é’®1 åŒºåŸŸ -->
  <div id="panel1" style="margin:20px 0;">
   <h3>æŠ•å¸</h3>
   <input id="inGolds" type="number" min="1" placeholder="è¾“å…¥æ­£æ•´æ•°é‡‘å¸">
   <button id="btn1">ç¡®è®¤æŠ•å¸</button>
   <div id="rst1" style="margin-top:8px;"></div>
  </div>
</body>
<script>
  console.log(localStorage.getItem('uid'));
  const $ = id => document.getElementById(id);
  const inGolds = $('inGolds');
  const rst1   = $('rst1');
  const btn1   = $('btn1');

  btn1.onclick = async () => {
    const n = Number(inGolds.value);
    if (!Number.isInteger(n) || n <= 0) {
      show(rst1, 'è¯·è¾“å…¥æ­£æ•´æ•°é‡‘å¸ï¼', false);
      return;
    }

    const uid = localStorage.getItem('uid');
    if (!uid) {                       // ä¿é™©èµ·è§å†åˆ¤ä¸€æ¬¡
      show(rst1, 'æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•', false);
      return;
    }

    btn1.disabled = true;
    try {
      const res = await fetch('http://47.92.231.94:8080/game/play', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ uid, golds: n })
      });
      const data = await res.json();
      handleResult(data);
    } catch (e) {
      show(rst1, 'ç½‘ç»œé”™è¯¯ï¼š' + e, false);
    } finally {
      btn1.disabled = false;
    }
  };

  function handleResult(data) {
    switch (data.code) {
      case 0:   // èµ¢äº†
        show(rst1, `${data.msg}ï¼Œå½“å‰ä½™é¢ ${data.nowGolds}`, true);
        break;
      case 1:   // æ­£æ•°æ£€æŸ¥ï¼ˆè‹¥åç«¯å†æ‹¦ä¸€æ¬¡ï¼‰
      case 2:   // ä½™é¢ä¸è¶³
        show(rst1, `${data.msg}ï¼Œå½“å‰ä½™é¢ ${data.nowGolds}`, true);
      case 3:   // ç”¨æˆ·ä¸å­˜åœ¨
        show(rst1, data.msg, false);
        break;
      case 8:   //è¾“äº†
        show(rst1, `${data.msg}ï¼Œå½“å‰ä½™é¢ ${data.nowGolds}`, false);
        break;
      default:
        show(rst1, 'æœªçŸ¥çŠ¶æ€ç ï¼š' + data.code, false);
    }
  }

  function show(box, text, isOk) {
    box.textContent = text;
    box.style.color = isOk ? 'green' : 'crimson';
  }
</script>
</html>