<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âπ∏ËøêÈõÜÂç°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            gap: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(108, 92, 231, 0.3);
            margin-bottom: 10px;
        }

        .user-info {
            font-size: 1.1rem;
            color: #a29bfe;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .user-id {
            background: rgba(162, 155, 254, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        button {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .function-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .func-button {
            padding: 15px 25px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 150px;
        }

        .func-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4);
            text-decoration: none;
            color: white;
        }

        .func-button:active {
            transform: translateY(-1px);
        }

        .func-button.game {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
        }

        .func-button.bank {
            background: linear-gradient(45deg, #00b894, #55efc4);
        }

        .func-button.market {
            background: linear-gradient(45deg, #e17055, #fab1a0);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* ‰∏™‰∫∫‰ø°ÊÅØÈù¢ÊùøÊ†∑Âºè */
        .user-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 280px;
            transition: all 0.3s ease;
            z-index: 10;
            max-height: 60px;
            overflow: hidden;
        }

        .user-panel.expanded {
            max-height: 400px;
        }

        .user-panel h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            justify-content: space-between;
            cursor: pointer;
        }

        .user-toggle {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        .user-panel.expanded .user-toggle {
            transform: rotate(180deg);
        }

        .user-panel button {
            width: 100%;
            padding: 10px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .user-panel pre {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        .user-panel pre.show {
            opacity: 1;
            max-height: 300px;
            margin-top: 15px;
            overflow-y: auto;
        }

        .user-panel pre.success {
            color: #00b894;
            border: 1px solid rgba(0, 184, 148, 0.3);
        }

        .user-panel pre.error {
            color: #e17055;
            border: 1px solid rgba(225, 112, 85, 0.3);
        }

        .user-panel pre::-webkit-scrollbar {
            width: 4px;
        }

        .user-panel pre::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .user-panel pre::-webkit-scrollbar-thumb {
            background: rgba(108, 92, 231, 0.5);
            border-radius: 2px;
        }

        .user-panel pre::-webkit-scrollbar-thumb:hover {
            background: rgba(108, 92, 231, 0.7);
        }

        /* ÊâÄÊúâÂç°ÁâåÈù¢ÊùøÊ†∑Âºè */
        .all-cards-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 200px;
            z-index: 10;
        }

        .all-cards-panel h3 {
            font-size: 1.2rem;
            margin-bottom: 0;
            text-align: center;
            color: #a29bfe;
        }

        .all-cards-button {
            width: 100%;
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #0984e3, #74b9ff);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            text-decoration: none;
        }

        .all-cards-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(9, 132, 227, 0.4);
            text-decoration: none;
            color: white;
        }

        .all-cards-button:active {
            transform: translateY(0);
        }

        .card-icon {
            font-size: 1.2rem;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫ÂüüÊ†∑Âºè */
        .main-content {
            min-height: 300px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            margin-top: 20px;
            padding: 30px 20px;
        }

        .placeholder-text {
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.5rem;
            font-weight: 300;
            text-align: center;
            padding: 40px;
        }

        /* Âç°ÂåÖÊ†∑Âºè */
        .card-pack {
            width: 220px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card-pack:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .card-pack.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .pack-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .pack-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(45deg, transparent, transparent);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .pack-id {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
        }

        .pack-price {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #fdcb6e;
        }

        .pack-price span {
            font-size: 1.5rem;
        }

        .pack-button {
            width: 100%;
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .pack-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .pack-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .pack-button:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* bangdreamÂåÖÊ†∑Âºè - Á≤âËâ≤Á≥ª */
        .pack-bangdream {
            border-color: rgba(225, 112, 85, 0.4);
            background: linear-gradient(135deg, rgba(225, 112, 85, 0.1), rgba(232, 67, 147, 0.1));
        }

        .pack-bangdream .pack-title {
            background: linear-gradient(45deg, #e17055, #e84393);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .pack-bangdream .pack-button {
            background: linear-gradient(45deg, #e17055, #e84393);
            color: white;
        }

        /* ‰∏âÂõΩÊùÄÂåÖÊ†∑Âºè - Á∫¢Ëâ≤Á≥ª */
        .pack-sanguosha {
            border-color: rgba(225, 65, 65, 0.4);
            background: linear-gradient(135deg, rgba(225, 65, 65, 0.1), rgba(214, 48, 49, 0.1));
        }

        .pack-sanguosha .pack-title {
            background: linear-gradient(45deg, #e14141, #d63031);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .pack-sanguosha .pack-button {
            background: linear-gradient(45deg, #e14141, #d63031);
            color: white;
        }

        /* ÁéãËÄÖËç£ËÄÄÂåÖÊ†∑Âºè - ÈáëËâ≤Á≥ª */
        .pack-wzry {
            border-color: rgba(253, 203, 110, 0.4);
            background: linear-gradient(135deg, rgba(253, 203, 110, 0.1), rgba(225, 177, 44, 0.1));
        }

        .pack-wzry .pack-title {
            background: linear-gradient(45deg, #fdcb6e, #e1b12c);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .pack-wzry .pack-button {
            background: linear-gradient(45deg, #fdcb6e, #e1b12c);
            color: #2d3436;
        }

        /* Á©∫Ê¥ûÈ™ëÂ£´ÂåÖÊ†∑Âºè - ÈªëËâ≤Á≥ª */
        .pack-kdqs {
            border-color: rgba(9, 9, 9, 0.4);
            background: linear-gradient(135deg, rgba(225, 65, 65, 0.1), rgba(214, 48, 49, 0.1));
        }

        .pack-kdqs .pack-title {
            background: linear-gradient(45deg, #f6f4f4, #e4e2e2);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .pack-kdqs .pack-button {
            background: linear-gradient(45deg, #151313, #0a0909);
            color: white;
        }

        /* ÊäΩÂç°ÁªìÊûúÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            border: none !important;
            /* ÁßªÈô§Â§ñËæπÊ°Ü */
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease;
            z-index: 1001;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .card-image {
            width: 200px;
            height: 280px;
            object-fit: cover;
            border-radius: 12px;
            border: 3px solid;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .image-placeholder {
            width: 200px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 3px dashed rgba(255, 255, 255, 0.2);
            font-size: 2rem;
        }

        .card-info {
            text-align: center;
        }

        .card-info h3 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: #fdcb6e;
        }

        .rarity-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .rarity-common {
            background: rgba(116, 125, 140, 0.3);
            color: #a0aec0;
        }

        .rarity-uncommon {
            background: rgba(72, 187, 120, 0.3);
            color: #48bb78;
        }

        .rarity-rare {
            background: rgba(66, 153, 225, 0.3);
            color: #4299e1;
        }

        .rarity-epic {
            background: rgba(159, 122, 234, 0.3);
            color: #9f7aea;
        }

        .rarity-legendary {
            background: rgba(237, 137, 54, 0.3);
            color: #ed8936;
        }

        .card-details {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .receipt {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .receipt h4 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #a29bfe;
            text-align: center;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .receipt-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .receipt-label {
            color: rgba(255, 255, 255, 0.7);
        }

        .receipt-value {
            color: #fdcb6e;
            font-weight: 600;
        }

        .receipt-total {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-button.primary {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
        }

        .modal-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .error-message {
            background: rgba(225, 112, 85, 0.2);
            border: 1px solid rgba(225, 112, 85, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .error-message h3 {
            color: #e17055;
            margin-bottom: 10px;
        }

        .error-message p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* ÂºÄÁÆ±Âä®ÁîªÁõ∏ÂÖ≥Ê†∑Âºè */
        .animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            display: none;
            pointer-events: none;
        }

        .animation-container.active {
            display: block;
        }

        .flash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            animation: flash 0.3s ease-out;
        }

        .light-beam {
            position: absolute;
            width: 2px;
            height: 300px;
            background: linear-gradient(to bottom, transparent, #ffffff, transparent);
            filter: blur(2px);
            transform-origin: center;
            animation: lightBeam 1.2s ease-out forwards;
        }

        .light-beam:nth-child(2) {
            transform: rotate(45deg);
        }

        .light-beam:nth-child(3) {
            transform: rotate(90deg);
        }

        .light-beam:nth-child(4) {
            transform: rotate(135deg);
        }

        .light-beam:nth-child(5) {
            transform: rotate(180deg);
        }

        .sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            filter: blur(1px);
            animation: sparkle 1.2s ease-out forwards;
        }

        .card-reveal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            animation: cardReveal 1s ease-out 0.3s forwards;
            z-index: 10;
        }

        .reveal-card {
            width: 240px;
            height: 336px;
            object-fit: cover;
            border-radius: 12px;
            border: 3px solid;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            animation: cardGlow 2s infinite alternate;
        }

        .rarity-glow {
            animation: rarityPulse 1.5s infinite alternate;
        }

        @keyframes flash {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                opacity: 0;
            }
        }

        @keyframes lightBeam {
            0% {
                opacity: 0;
                transform: scale(0.5) rotate(var(--rotation, 0deg));
            }

            20% {
                opacity: 1;
                transform: scale(1) rotate(var(--rotation, 0deg));
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: scale(1.2) rotate(var(--rotation, 0deg));
            }
        }

        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }

            20% {
                transform: scale(1) rotate(180deg);
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes cardReveal {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }

            70% {
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes cardGlow {
            0% {
                box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.3);
            }

            100% {
                box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.7);
            }
        }

        @keyframes rarityPulse {
            0% {
                filter: brightness(1) drop-shadow(0 0 5px currentColor);
            }

            100% {
                filter: brightness(1.5) drop-shadow(0 0 20px currentColor);
            }
        }

        .pack-opening {
            animation: packShake 0.5s ease-in-out 3, packPulse 1s ease-out;
        }

        @keyframes packShake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-5px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(5px);
            }
        }

        @keyframes packPulse {
            0% {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2), 0 0 0 rgba(253, 203, 110, 0);
            }

            50% {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2), 0 0 30px rgba(253, 203, 110, 0.6);
            }

            100% {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2), 0 0 0 rgba(253, 203, 110, 0);
            }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 20px;
            opacity: 0;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .user-panel {
                position: static;
                width: 100%;
                margin-bottom: 20px;
            }

            .all-cards-panel {
                position: static;
                width: 100%;
                margin-bottom: 20px;
            }

            .main-container {
                flex-direction: column;
            }

            .container {
                max-width: 100%;
            }

            .function-buttons {
                flex-direction: column;
                width: 100%;
            }

            .func-button {
                width: 100%;
            }

            .main-content {
                flex-direction: column;
                align-items: center;
            }

            .card-pack {
                width: 100%;
                max-width: 280px;
            }

            .modal-content {
                padding: 20px;
            }

            .card-image,
            .image-placeholder {
                width: 150px;
                height: 210px;
            }

            .reveal-card {
                width: 180px;
                height: 252px;
            }
        }

        .my-cards-button {
            width: 100%;
            padding: 10px 15px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #e84393, #fd79a8);
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            text-decoration: none;
            text-align: center;
        }

        .my-cards-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(232, 67, 147, 0.4);
            text-decoration: none;
            color: white;
        }

        .my-cards-button:active {
            transform: translateY(0);
        }

        .achievement-button {
            width: 100%;
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #087e2b, #0ff47e);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            text-decoration: none;
        }

        .achievement-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(9, 132, 227, 0.4);
            text-decoration: none;
            color: white;
        }

        .achievement-button:active {
            transform: translateY(0);
        }

        @media (max-width: 480px) {
            .user-panel {
                width: 100%;
            }

            .user-panel pre {
                font-size: 0.85rem;
            }

            .all-cards-panel {
                width: 100%;
            }

            .all-cards-button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .achievement-button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            h1 {
                font-size: 2rem;
            }

            .placeholder-text {
                font-size: 1.2rem;
                padding: 20px;
            }

            .card-pack {
                padding: 15px;
            }

            .pack-icon {
                font-size: 3rem;
            }

            .pack-title {
                font-size: 1.2rem;
            }

            .modal-header h2 {
                font-size: 1.5rem;
            }

            .modal-actions {
                flex-direction: column;
            }
        }

        /* ÂºÄÁÆ±Âä®Áîª‰∏≠ÁöÑÂç°Áâá */
        .reveal-card {
            max-width: 100%;
            max-height: 300px;
            object-fit: contain;
            transition: transform 0.5s ease;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Ê®™ÂõæÔºà1280x720 16:9ÊØî‰æãÔºâ */
        .reveal-card.landscape {
            max-width: 320px;
            max-height: 180px;
            width: auto;
            height: auto;
        }

        /* Á´ñÂõæ */
        .reveal-card.portrait {
            max-width: 180px;
            max-height: 320px;
            width: auto;
            height: auto;
        }

        /* ÊñπÂõæ */
        .reveal-card.square {
            max-width: 250px;
            max-height: 250px;
            width: auto;
            height: auto;
        }

        /* Ê®°ÊÄÅÊ°ÜÂç°ÁâáÂÆπÂô® */
        .card-image-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            min-height: 200px;
            width: 100%;
            overflow: hidden;
        }

        /* Ê®°ÊÄÅÊ°Ü‰∏≠ÁöÑÂç°ÁâáÂõæÁâá */
        .card-image-result {
            border: none !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;

            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        /* Ê®™ÂõæÔºà1280x720 16:9ÊØî‰æãÔºâ */
        .card-image-result.landscape {
            max-width: 400px;
            /* Ê°åÈù¢Á´ØÊòæÁ§∫Êõ¥Â§ß */
            max-height: 225px;
            /* ‰øùÊåÅ 16:9 ÊØî‰æã */
            width: auto;
            height: auto;
        }

        /* Á´ñÂõæÔºàÂ∏∏ËßÅÊØî‰æã 2:3 Êàñ 3:4Ôºâ */
        .card-image-result.portrait {
            max-width: 200px;
            max-height: 300px;
            width: auto;
            height: auto;
        }

        /* ÊñπÂõæ */
        .card-image-result.square {
            max-width: 250px;
            max-height: 250px;
            width: auto;
            height: auto;
        }

        /* Á®ÄÊúâÂ∫¶ËæπÊ°ÜË¶ÜÁõñÂ±Ç */
        .rarity-overlay {
            border: none !important;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 3px solid;
            border-radius: 8px;
            pointer-events: none;
            animation: rarityGlow 2s ease-in-out infinite;
        }

        /* Âç°ÁâáÊòæÁ§∫Âå∫Âüü */
        .card-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
            width: 100%;
        }

        /* Âç°Áâá‰ø°ÊÅØ */
        .card-info {
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .card-image-wrapper {
            border: none !important;
        }

        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {

            /* Ê®™ÂõæÂú®Âπ≥Êùø‰∏äÁöÑÂ∞∫ÂØ∏ */
            .card-image-result.landscape {
                max-width: 320px;
                max-height: 180px;
            }

            .card-image-result.portrait {
                max-width: 180px;
                max-height: 270px;
            }

            .card-image-result.square {
                max-width: 200px;
                max-height: 200px;
            }

            .reveal-card.landscape {
                max-width: 280px;
                max-height: 158px;
            }
        }

        @media (max-width: 480px) {

            /* Ê®™ÂõæÂú®ÊâãÊú∫‰∏äÁöÑÂ∞∫ÂØ∏ */
            .card-image-result.landscape {
                max-width: 280px;
                max-height: 158px;
            }

            .card-image-result.portrait {
                max-width: 150px;
                max-height: 225px;
            }

            .card-image-result.square {
                max-width: 180px;
                max-height: 180px;
            }

            .reveal-card.landscape {
                max-width: 240px;
                max-height: 135px;
            }
        }
    </style>
</head>

<body>
    <!-- ÂºÄÁÆ±Âä®ÁîªÂÆπÂô® -->
    <div class="animation-container" id="animationContainer">
        <!-- <div class="flash-overlay"></div> -->
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="card-reveal" id="cardReveal">
            <img src="" alt="" class="reveal-card" id="revealCard">
        </div>
    </div>

    <!-- ÊâÄÊúâÂç°ÁâåÈù¢ÊùøÔºàÂõ∫ÂÆöÂú®Â∑¶‰∏äËßíÔºâ -->
    <div class="all-cards-panel">
        <h3>üÉèÂç°ÁâåÁ≥ªÁªü</h3>
        <a href="allcard.html" class="all-cards-button">
            <span class="card-icon"></span>
            <span>ÊâÄÊúâÂç°Áâå</span>
        </a>
        <!-- Êñ∞Âä†ÂÖ•ÁöÑÊü•ÁúãÊàëÁöÑÂç°ÁâáÊåâÈíÆ -->
        <a href="mycards.html" class="my-cards-button">
            <span>Êü•ÁúãÊàëÁöÑÂç°Áâá</span>
        </a>
        <a href="achievement.html" class="achievement-button">
            <span class="card-icon"></span>
            <span>Âç°ÁâåÂ±ïÊùø-ÊéíË°åÊ¶ú</span>
        </a>
    </div>

    <!-- ‰∏™‰∫∫‰ø°ÊÅØÈù¢ÊùøÔºàÂõ∫ÂÆöÂú®Âè≥‰∏äËßíÔºâ -->
    <div class="user-panel" id="userPanel">
        <h3 onclick="toggleUserPanel()">
            <span>üë§ ‰∏™‰∫∫‰∏≠ÂøÉ</span>
            <span class="user-toggle">‚ñº</span>
        </h3>
        <button id="btn2">Âà∑Êñ∞‰∏™‰∫∫‰ø°ÊÅØ</button>
        <pre id="rst2"></pre>
    </div>

    <!-- ÊäΩÂç°ÁªìÊûúÊ®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="drawModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéâ ÊäΩÂç°ÁªìÊûú üéâ</h2>
                <p id="modalSubtitle">ÊÅ≠Âñú‰Ω†Ëé∑Âæó‰∫ÜÂç°ÁâáÔºÅ</p>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- ÂÜÖÂÆπÁî±JavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" onclick="closeDrawModal()">ÂÖ≥Èó≠</button>
                <button class="modal-button primary" onclick="closeDrawModalAndRefresh()">Á°ÆËÆ§Âπ∂ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- ÈîôËØØÊèêÁ§∫Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="errorModal">
        <div class="modal-content">
            <div class="error-message">
                <div class="error-icon">‚ùå</div>
                <h3 id="errorTitle">Êìç‰ΩúÂ§±Ë¥•</h3>
                <p id="errorMessage"></p>
                <button class="modal-button secondary" onclick="closeErrorModal()">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="container">
            <div class="header">
                <h1>Âπ∏ËøêÈõÜÂç°</h1>
                <div class="user-info">
                    <span>Áî®Êà∑ID:</span>
                    <span class="user-id" id="userIdDisplay">Âä†ËΩΩ‰∏≠...</span>
                </div>
            </div>

            <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü - Âç°ÂåÖÂ±ïÁ§∫ -->
            <div class="main-content" id="mainContent">
                <!-- bangdreamÂåÖ -->
                <div class="card-pack pack-bangdream disabled">
                    <div class="pack-icon">
                        <img src="./images/BANGDREAM/logo.jpg" style="height:1.3em; vertical-align:center;">
                    </div>
                    <div class="pack-title">bangdreamÂç°ÂåÖ</div>
                    <div class="pack-id">Âç°ÂåÖID: 1</div>
                    <div class="pack-price">‰ª∑Ê†º: <span>20</span> Â∏Å</div>
                    <button class="pack-button" data-set-id="1" disabled>
                        <span>Ë¥≠‰π∞Âπ∂ÊâìÂºÄ</span>
                        <span>(20Â∏Å)</span>
                    </button>
                </div>

                <!-- ‰∏âÂõΩÊùÄÂåÖ -->
                <div class="card-pack pack-sanguosha" id="sgsPack">
                    <div class="pack-icon">
                        <img src="./images/‰∏âÂõΩÊùÄ/logo.png" style="height:1.3em; vertical-align:center;">
                    </div>
                    <div class="pack-title">‰∏âÂõΩÊùÄÂç°ÂåÖ</div>
                    <div class="pack-id">Âç°ÂåÖID: 2</div>
                    <div class="pack-price">‰ª∑Ê†º: <span>20</span> Â∏Å</div>
                    <button class="pack-button" data-set-id="2">
                        <span>Ë¥≠‰π∞Âπ∂ÊâìÂºÄ</span>
                        <span>(20Â∏Å)</span>
                    </button>
                </div>

                <!-- ÁéãËÄÖËç£ËÄÄÂåÖ -->
                <div class="card-pack pack-wzry" id="wzryPack">
                    <div class="pack-icon">
                        <img src="./images/ÁéãËÄÖËç£ËÄÄ/logo.png" style="height:1.3em; vertical-align:center;">
                    </div>
                    <div class="pack-title">ÁéãËÄÖËç£ËÄÄÂç°ÂåÖ</div>
                    <div class="pack-id">Âç°ÂåÖID: 3</div>
                    <div class="pack-price">‰ª∑Ê†º: <span>20</span> Â∏Å</div>
                    <button class="pack-button" data-set-id="3">
                        <span>Ë¥≠‰π∞Âπ∂ÊâìÂºÄ</span>
                        <span>(20Â∏Å)</span>
                    </button>
                </div>

                <!-- GALGAMEÂåÖ -->
                <div class="card-pack pack-bangdream" id="galgamePack">
                    <div class="pack-icon">
                        <img src="./images/GALGAME/logo.jpg" style="height:1.3em; vertical-align:center;">
                    </div>
                    <div class="pack-title">galgame-CGÂç°ÂåÖ</div>
                    <div class="pack-id">Âç°ÂåÖID: 4</div>
                    <div class="pack-price">‰ª∑Ê†º: <span>20</span> Â∏Å</div>
                    <button class="pack-button" data-set-id="4">
                        <span>Ë¥≠‰π∞Âπ∂ÊâìÂºÄ</span>
                        <span>(20Â∏Å)</span>
                    </button>
                </div>

                <!-- Á©∫Ê¥ûÈ™ëÂ£´ÂåÖ -->
                <div class="card-pack pack-kdqs" id="kdqsPack">
                    <div class="pack-icon">
                        <img src="./images/Á©∫Ê¥ûÈ™ëÂ£´/logo.png" style="height:1.3em; vertical-align:center;">
                    </div>
                    <div class="pack-title">Á©∫Ê¥ûÈ™ëÂ£´Âç°ÂåÖ</div>
                    <div class="pack-id">Âç°ÂåÖID: 5</div>
                    <div class="pack-price">‰ª∑Ê†º: <span>20</span> Â∏Å</div>
                    <button class="pack-button" data-set-id="5">
                        <span>Ë¥≠‰π∞Âπ∂ÊâìÂºÄ</span>
                        <span>(20Â∏Å)</span>
                    </button>
                </div>
            </div>

            <!-- ÂäüËÉΩÊåâÈíÆÂå∫Âüü -->
            <div class="function-buttons">
                <a href="game.html" class="func-button game">
                    üéÆ ËøîÂõûÊ∏∏Êàè
                </a>
                <a href="bank.html" class="func-button bank">
                    üè¶ Èì∂Ë°åÁ≥ªÁªü
                </a>
                <a href="market.html" class="func-button market">
                    üè™ ‰∫§ÊòìÂ§ßÂéÖ
                </a>
            </div>
        </div>
    </div>

    <script>
        // Ëé∑ÂèñDOMÂÖÉÁ¥†
        const $ = id => document.getElementById(id);
        const userIdDisplay = $('userIdDisplay');
        const btn2 = $('btn2');
        const rst2 = $('rst2');
        const userPanel = $('userPanel');
        const mainContent = $('mainContent');
        const drawModal = $('drawModal');
        const errorModal = $('errorModal');
        const modalBody = $('modalBody');
        const errorMessage = $('errorMessage');
        const errorTitle = $('errorTitle');
        const animationContainer = $('animationContainer');
        const cardReveal = $('cardReveal');
        const revealCard = $('revealCard');
        const wzryPack = $('wzryPack');

        // Ëé∑ÂèñÁî®Êà∑ID
        const uid = () => localStorage.getItem('uid');
        // Ëé∑Âèñcookie
        const cookie = () => localStorage.getItem('cookie');

        // APIË∞ÉÁî®ÂáΩÊï∞
        const api = (path, body) => fetch('http://47.92.231.94:8080' + path, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });

        // ÂàáÊç¢‰∏™‰∫∫‰ø°ÊÅØÈù¢ÊùøÂ±ïÂºÄ/Êî∂Ëµ∑
        function toggleUserPanel() {
            userPanel.classList.toggle('expanded');
        }

        // ÊòæÁ§∫Áî®Êà∑ID
        function displayUserId() {
            const userUid = uid();
            if (userUid) {
                userIdDisplay.textContent = userUid;
                userIdDisplay.classList.add('pulse');
            } else {
                userIdDisplay.textContent = 'Êú™ÁôªÂΩï';
                userIdDisplay.style.color = '#e17055';
            }
        }

        // ÂàùÂßãÂåñÊòæÁ§∫Áî®Êà∑ID
        displayUserId();

        // Ëé∑ÂèñÂπ∂ÊòæÁ§∫‰∏™‰∫∫‰ø°ÊÅØ
        async function loadUserInfo() {
            const userUid = uid();
            const userCookie = cookie();
            if (!userUid) {
                showUserInfo('Êú™ÁôªÂΩïÔºåËØ∑ÂÖàÁôªÂΩï', false);
                return;
            }

            btn2.disabled = true;
            btn2.innerHTML = '<span class="spinner"></span> Âä†ËΩΩ‰∏≠...';

            try {
                const res = await api('/user/info', { cookie: userCookie });
                const data = await res.json();
                handleInfo(data);
            } catch (e) {
                showUserInfo('ÁΩëÁªúÈîôËØØÔºö' + e, false);
            } finally {
                btn2.disabled = false;
                btn2.innerHTML = 'Âà∑Êñ∞‰∏™‰∫∫‰ø°ÊÅØ';
            }
        }

        // Â§ÑÁêÜ‰∏™‰∫∫‰ø°ÊÅØ - ÁæéÂåñÊòæÁ§∫
        function handleInfo(data) {
            if (data.code === -1) {
                // ÂêéÁ´ØË¶ÅÊ±Ç‰∏çÊâìÂç∞
                showUserInfo('', true);
                return;
            }

            // ËÆ°ÁÆóÊÄªËµÑ‰∫ß
            const netWorth = (data.amount || 0) + (data.account || 0) - (data.loan || 0);

            // ÁæéÂåñÊòæÁ§∫Ê†ºÂºè
            const infoText = `
Áî®Êà∑IDÔºö${data.id || 'Êú™Áü•'}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Áé∞Èáë‰ΩôÈ¢ùÔºö${data.amount || 0} 
Èì∂Ë°åÂ≠òÊ¨æÔºö${data.account || 0} 
ÂæÖËøòË¥∑Ê¨æÔºö${data.loan || 0} 
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
ÊÄªËµÑ‰∫ßÔºö${netWorth} 
      `;

            showUserInfo(infoText, true);
        }

        // ÊòæÁ§∫Áî®Êà∑‰ø°ÊÅØ
        function showUserInfo(text, isOk) {
            // ÁßªÈô§‰πãÂâçÁöÑÁ±ª
            rst2.classList.remove('success', 'error', 'show');

            // ËÆæÁΩÆÊñáÊú¨
            rst2.textContent = text;

            // Ê∑ªÂä†ÈÄÇÂΩìÁöÑÁ±ª
            if (text) {
                rst2.classList.add(isOk ? 'success' : 'error');
            }

            // Âº∫Âà∂ÈáçÊéí‰ª•Ëß¶ÂèëÂä®Áîª
            void rst2.offsetWidth;

            // Ê∑ªÂä†ÊòæÁ§∫Á±ª
            if (text) {
                rst2.classList.add('show');
            }

            // Â±ïÂºÄÈù¢ÊùøÊòæÁ§∫‰ø°ÊÅØ
            userPanel.classList.add('expanded');
        }

        // ‰∏™‰∫∫‰ø°ÊÅØÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        btn2.onclick = loadUserInfo;

        // È°µÈù¢Âä†ËΩΩÊó∂Ëá™Âä®ÊòæÁ§∫‰∏™‰∫∫‰ø°ÊÅØ
        window.addEventListener('load', () => {
            setTimeout(loadUserInfo, 1000);
        });

        // Èò≤ÈáçÂ§çÁÇπÂáªÊ†áÂøó
        let isProcessing = false;
        let currentPackElement = null;

        // Êí≠ÊîæÂºÄÁÆ±Âä®Áîª
        function playOpenAnimation(cardData) {
            return new Promise((resolve) => {
                // ÊòæÁ§∫Âä®ÁîªÂÆπÂô®
                animationContainer.classList.add('active');

                // ÂàõÂª∫ÂÖâÊü±
                const beams = document.querySelectorAll('.light-beam');
                beams.forEach((beam, index) => {
                    beam.style.setProperty('--rotation', `${index * 45}deg`);
                });

                // ÂàõÂª∫Èó™ÁÉÅÁ≤íÂ≠ê
                createSparkles();

                // ËÆæÁΩÆÂç°ÁâáÂõæÁâá
                const imagePath = `./images/${cardData.set_name}/${cardData.rarity_id}/${cardData.image_url}`;
                revealCard.src = imagePath;
                revealCard.alt = cardData.name;

                revealCard.onload = function () {
                    // ÂõæÁâáÂä†ËΩΩÂÆåÊàêÂêéÔºåÊ†πÊçÆÂÆûÈôÖÊØî‰æãË∞ÉÊï¥ÊòæÁ§∫
                    adjustCardDisplay(revealCard);
                };
                revealCard.onerror = function () {
                    // ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•Êó∂Ôºå‰ΩøÁî®Âõ∫ÂÆöÊØî‰æã
                    this.style.aspectRatio = '5/7'; // ÈªòËÆ§Âç°ÁâáÊØî‰æã
                };

                // Ê†πÊçÆÁ®ÄÊúâÂ∫¶ËÆæÁΩÆËæπÊ°ÜÈ¢úËâ≤
                let rarityColor = '#a0aec0';
                switch (cardData.rarity_id) {
                    case 1: rarityColor = '#a0aec0'; break;
                    case 2: rarityColor = '#48bb78'; break;
                    case 3: rarityColor = '#4299e1'; break;
                    case 4: rarityColor = '#9f7aea'; break;
                    case 5: rarityColor = '#ed8936'; break;
                }
                revealCard.style.borderColor = rarityColor;

                // Â¶ÇÊûúÊòØÂè≤ËØóÊàñ‰º†ËØ¥Âç°ÁâáÔºåÊ∑ªÂä†Èó™ÁÉÅÊïàÊûú
                if (cardData.rarity_id >= 4) {
                    revealCard.classList.add('rarity-glow');
                }

                // Âä®ÁîªÁªìÊùüÂêéÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                setTimeout(() => {
                    animationContainer.classList.remove('active');
                    revealCard.classList.remove('rarity-glow');
                    resolve();
                }, 2000);
            });
        }

        // Ë∞ÉÊï¥Âç°ÁâáÊòæÁ§∫ÊØî‰æã
        function adjustCardDisplay(imgElement) {
            const img = imgElement;
            const container = img.parentElement;

            if (img.naturalWidth && img.naturalHeight) {
                const aspectRatio = img.naturalWidth / img.naturalHeight;

                // ÁßªÈô§‰πãÂâçÁöÑÂÆΩÈ´òËÆæÁΩÆ
                img.style.width = '';
                img.style.height = '';
                img.style.aspectRatio = aspectRatio;

                // Ê†πÊçÆÂÆΩÈ´òÊØîÂ∫îÁî®‰∏çÂêåÁöÑÁ±ª
                img.classList.remove('portrait', 'landscape', 'square');
                if (aspectRatio > 1.2) {
                    img.classList.add('landscape');  // Ê®™Âõæ
                } else if (aspectRatio < 0.8) {
                    img.classList.add('portrait');    // Á´ñÂõæ
                } else {
                    img.classList.add('square');      // ÊñπÂõæ
                }
            }
        }

        // ÂàõÂª∫Èó™ÁÉÅÁ≤íÂ≠ê
        function createSparkles() {
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';

                // ÈöèÊú∫‰ΩçÁΩÆ
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                sparkle.style.left = `${x}%`;
                sparkle.style.top = `${y}%`;

                // ÈöèÊú∫Â§ßÂ∞è
                const size = Math.random() * 6 + 4;
                sparkle.style.width = `${size}px`;
                sparkle.style.height = `${size}px`;

                // ÈöèÊú∫È¢úËâ≤
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#feca57', '#ff9ff3', '#54a0ff'];
                sparkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                // ÈöèÊú∫Âä®ÁîªÂª∂Ëøü
                sparkle.style.animationDelay = `${Math.random() * 0.5}s`;

                animationContainer.appendChild(sparkle);

                // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
                setTimeout(() => {
                    sparkle.remove();
                }, 1200);
            }

            // Ê∑ªÂä†‰∏Ä‰∫õÈ£òËêΩÁöÑÂΩ©Á∫∏
            for (let i = 0; i < 15; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';

                // ÈöèÊú∫‰ΩçÁΩÆ
                const x = Math.random() * 100;
                confetti.style.left = `${x}%`;

                // ÈöèÊú∫Â§ßÂ∞è
                const width = Math.random() * 8 + 4;
                const height = Math.random() * 12 + 8;
                confetti.style.width = `${width}px`;
                confetti.style.height = `${height}px`;

                // ÈöèÊú∫È¢úËâ≤
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#feca57', '#ff9ff3', '#54a0ff'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                // ÈöèÊú∫Âä®ÁîªÂª∂Ëøü
                confetti.style.animationDelay = `${Math.random() * 0.8}s`;

                // ÈöèÊú∫ÊóãËΩ¨
                const rotation = Math.random() * 360;
                confetti.style.transform = `translateY(-100px) rotate(${rotation}deg)`;

                animationContainer.appendChild(confetti);

                // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }

        // Âç°ÂåÖÊäñÂä®Âä®Áîª
        function playPackShake(packElement) {
            packElement.classList.add('pack-opening');
            setTimeout(() => {
                packElement.classList.remove('pack-opening');
            }, 1500);
        }

        // Â§ÑÁêÜÂç°ÂåÖË¥≠‰π∞
        async function handlePackPurchase(setId, button, packElement) {
            // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
            if (isProcessing) {
                return;
            }

            isProcessing = true;
            currentPackElement = packElement;

            // Âè™ÊúâÁéãËÄÖËç£ËÄÄÂåÖÔºàsetId=3ÔºâÂèØ‰ª•ÁÇπÂáª
            if (setId === '3' || setId === '5' || setId === '4' || setId === '2') {
                const userCookie = cookie();
                if (!userCookie) {
                    showError('Êú™ÁôªÂΩï', 'ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçËøõË°åË¥≠‰π∞Êìç‰Ωú');
                    isProcessing = false;
                    return;
                }

                const originalText = button.innerHTML;

                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                button.disabled = true;
                button.innerHTML = '<span class="spinner"></span> Ë¥≠‰π∞‰∏≠...';

                // Êí≠ÊîæÂç°ÂåÖÊäñÂä®Âä®Áîª
                playPackShake(packElement);

                try {
                    // Ë∞ÉÁî®ÊäΩÂç°API
                    const response = await api('/card/draw', {
                        cookie: userCookie,
                        set_id: parseInt(setId)
                    });

                    const data = await response.json();

                    if (data.status === 'success' && data.code === 200) {
                        // ÂÖàÊí≠ÊîæÂºÄÁÆ±Âä®Áîª
                        await playOpenAnimation(data.data.draw_result.card_info);

                        // Âä®ÁîªÊí≠ÊîæÂÆåÊàêÂêéÊòæÁ§∫ÁªìÊûú
                        setTimeout(() => {
                            showDrawResult(data.data);
                        }, 500);
                    } else {
                        // Ë¥≠‰π∞Â§±Ë¥•ÔºåÊòæÁ§∫ÈîôËØØ
                        showError('Ë¥≠‰π∞Â§±Ë¥•', data.message || 'Êú™Áü•ÈîôËØØ');
                    }
                } catch (error) {
                    console.error('ÊäΩÂç°ÈîôËØØ:', error);
                    showError('ÁΩëÁªúÈîôËØØ', 'ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂêéÈáçËØï');
                } finally {
                    // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                    button.disabled = false;
                    button.innerHTML = originalText;
                    isProcessing = false;
                }
            } else {
                showError('ÊöÇÊú™ÂºÄÊîæ', 'ËØ•Âç°ÂåÖÊöÇÊú™ÂºÄÊîæÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ');
                isProcessing = false;
            }
        }

        // ‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÂ§ÑÁêÜÂç°ÂåÖÊåâÈíÆÁÇπÂáª
        document.addEventListener('DOMContentLoaded', function () {
            // Âè™Âú®mainContent‰∏äÁªëÂÆö‰∏ÄÊ¨°‰∫ã‰ª∂ÁõëÂê¨Âô®
            mainContent.addEventListener('click', function (event) {
                const button = event.target.closest('.pack-button');

                if (!button || button.disabled) {
                    return;
                }

                event.preventDefault();
                event.stopPropagation();

                const setId = button.getAttribute('data-set-id');
                const packElement = button.closest('.card-pack');
                handlePackPurchase(setId, button, packElement);
            });
        });

        // ÊòæÁ§∫ÊäΩÂç°ÁªìÊûú
        function showDrawResult(data) {
            const { draw_result, cost_info, set_info, user_info } = data;
            const { card_info } = draw_result;

            // ÊûÑÂª∫ÂõæÁâáË∑ØÂæÑ
            const imagePath = `./images/${card_info.set_name}/${card_info.rarity_id}/${card_info.image_url}`;

            // Ê†πÊçÆÁ®ÄÊúâÂ∫¶ËÆæÁΩÆÊ†∑Âºè
            let rarityClass = 'rarity-common';
            let rarityColor = '#a0aec0';

            switch (card_info.rarity_id) {
                case 1:
                    rarityClass = 'rarity-common';
                    rarityColor = '#a0aec0';
                    break;
                case 2:
                    rarityClass = 'rarity-uncommon';
                    rarityColor = '#48bb78';
                    break;
                case 3:
                    rarityClass = 'rarity-rare';
                    rarityColor = '#4299e1';
                    break;
                case 4:
                    rarityClass = 'rarity-epic';
                    rarityColor = '#9f7aea';
                    break;
                case 5:
                    rarityClass = 'rarity-legendary';
                    rarityColor = '#ed8936';
                    break;
            }

            // ÁîüÊàêÊ®°ÊÄÅÊ°ÜÂÜÖÂÆπ
            modalBody.innerHTML = `
        <div class="card-display">
        <div class="card-image-wrapper">
            <img src="${imagePath}"
                alt="${card_info.name}"
                class="card-image-result"
                onload="adjustModalCardDisplay(this)"
                onerror="handleModalImageError(this, '${card_info.name}', '${rarityColor}', '${card_info.rarity_name}')">
            <div class="rarity-overlay" style="border-color: ${rarityColor}"></div>
        </div>
        <div class="card-info">
            <h3>${card_info.name}</h3>
            <div class="rarity-badge ${rarityClass}">${card_info.rarity_name}</div>
            <div class="card-details">
                <div>ÂÖ®Â±ÄID: ${draw_result.card_global_id}</div>
                <div>Â•óÁ≥ª: ${card_info.set_name}</div>
            </div>
        </div>
    </div>
        
        <div class="receipt">
            <h4>üìÉ Ë¥≠‰π∞Êî∂ÊçÆ</h4>
            <div class="receipt-item">
                <span class="receipt-label">Â•óÁ≥ªÂêçÁß∞:</span>
                <span class="receipt-value">${set_info.set_name}</span>
            </div>
            <div class="receipt-item">
                <span class="receipt-label">Â•óÁ≥ªID:</span>
                <span class="receipt-value">${set_info.set_id}</span>
            </div>
            <div class="receipt-item">
                <span class="receipt-label">Áî®Êà∑ID:</span>
                <span class="receipt-value">${user_info.user_id}</span>
            </div>
            <div class="receipt-item">
                <span class="receipt-label">Ê∂àË¥πÈáëÈ¢ù:</span>
                <span class="receipt-value">-${cost_info.cost} Â∏Å</span>
            </div>
            <div class="receipt-item">
                <span class="receipt-label">Âéü‰ΩôÈ¢ù:</span>
                <span class="receipt-value">${cost_info.old_balance} Â∏Å</span>
            </div>
            <div class="receipt-item receipt-total">
                <span class="receipt-label">Êñ∞‰ΩôÈ¢ù:</span>
                <span class="receipt-value">${cost_info.new_balance} Â∏Å</span>
            </div>
        </div>`;

            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            drawModal.classList.add('show');

            // Ëá™Âä®Âà∑Êñ∞Áî®Êà∑‰ø°ÊÅØ
            setTimeout(loadUserInfo, 1000);
        }

        // Ë∞ÉÊï¥Ê®°ÊÄÅÊ°Ü‰∏≠ÁöÑÂç°ÁâáÊòæÁ§∫
        function adjustModalCardDisplay(imgElement) {
            const img = imgElement;
            if (img.naturalWidth && img.naturalHeight) {
                const aspectRatio = img.naturalWidth / img.naturalHeight;

                // ÁßªÈô§‰πãÂâçÁöÑÊ†∑Âºè
                img.style.maxWidth = '';
                img.style.maxHeight = '';
                img.style.width = '';
                img.style.height = '';
                img.style.aspectRatio = aspectRatio;

                // Ê†πÊçÆÂÆΩÈ´òÊØîÂàÜÁ±ª
                img.classList.remove('portrait', 'landscape', 'square');

                if (aspectRatio > 1.3) {
                    // Ê®™ÂõæÔºà1280x720 ÂÆΩÈ´òÊØî 1.78Ôºâ
                    img.classList.add('landscape');
                    img.style.maxWidth = '320px';   // ÈÄÇÂΩìÈôêÂà∂ÊúÄÂ§ßÂÆΩÂ∫¶
                    img.style.maxHeight = '180px';  // ‰øùÊåÅ 16:9 ÊØî‰æã
                } else if (aspectRatio < 0.8) {
                    // Á´ñÂõæ
                    img.classList.add('portrait');
                    img.style.maxWidth = '180px';
                    img.style.maxHeight = '320px';
                } else {
                    // Êé•ËøëÊñπÂõæ
                    img.classList.add('square');
                    img.style.maxWidth = '240px';
                    img.style.maxHeight = '240px';
                }
            }
        }

        // Â§ÑÁêÜÊ®°ÊÄÅÊ°ÜÂõæÁâáÂä†ËΩΩÈîôËØØ
        function handleModalImageError(imgElement, cardName, rarityColor, rarityName) {
            const svgContent = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 280">
            <rect width="200" height="280" fill="#1a1a2e" rx="8"/>
            <rect x="5" y="5" width="190" height="270" fill="#16213e" rx="4"/>
            <text x="50%" y="40%" font-family="Arial" font-size="16" fill="${rarityColor}" text-anchor="middle" dy=".3em">${cardName}</text>
            <text x="50%" y="50%" font-family="Arial" font-size="12" fill="#a29bfe" text-anchor="middle" dy=".3em">Á®ÄÊúâÂ∫¶: ${rarityName}</text>
            <text x="50%" y="60%" font-family="Arial" font-size="10" fill="#999" text-anchor="middle" dy=".3em">ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•</text>
        </svg>
    `;
            imgElement.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(svgContent);
            imgElement.style.aspectRatio = '5/7';
            imgElement.style.maxWidth = '200px';
            imgElement.style.maxHeight = '280px';
        }

        // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
        function showError(title, message) {
            errorTitle.textContent = title;
            errorMessage.textContent = message;
            errorModal.classList.add('show');
        }

        // ÂÖ≥Èó≠ÊäΩÂç°ÁªìÊûúÊ®°ÊÄÅÊ°Ü
        function closeDrawModal() {
            drawModal.classList.remove('show');
        }

        // ÂÖ≥Èó≠ÈîôËØØÊ®°ÊÄÅÊ°Ü
        function closeErrorModal() {
            errorModal.classList.remove('show');
        }

        // ÂÖ≥Èó≠ÊäΩÂç°ÁªìÊûúÊ®°ÊÄÅÊ°ÜÂπ∂Âà∑Êñ∞È°µÈù¢
        function closeDrawModalAndRefresh() {
            closeDrawModal();
            // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÂÖ∂‰ªñÂà∑Êñ∞ÈÄªËæë
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        drawModal.addEventListener('click', (e) => {
            if (e.target === drawModal) {
                closeDrawModal();
            }
        });

        errorModal.addEventListener('click', (e) => {
            if (e.target === errorModal) {
                closeErrorModal();
            }
        });

        // ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDrawModal();
                closeErrorModal();
            }
        });
    </script>
</body>

</html>